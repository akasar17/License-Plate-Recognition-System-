<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Indian Vehicle License Plate Detection - AI System</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap');
  *{box-sizing:border-box;}
  body {
    margin: 0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background:#f9f9f9; color:#333; display:flex; flex-direction:column; min-height:100vh;
  }
  header {
    background: linear-gradient(135deg, #ff9933, #138808);
    color:white; padding:1rem 1.5rem; text-align:center; font-weight:700;
    font-size:1.3rem; letter-spacing:1px; user-select:none;
  }
  main {
    flex:1; max-width:900px; margin:1rem auto; width:95%;
    background:white; border-radius:12px; box-shadow:0 8px 24px rgb(0 0 0 / 0.12);
    padding:1rem;
  }
  .mode-selector {
    display:flex; justify-content:center; gap:1rem; margin-bottom:1rem;
  }
  .mode-btn {
    background:#eee; border:none; padding:0.6rem 1.5rem; font-size:1rem;
    font-weight:600; border-radius:30px; cursor:pointer; transition:background-color 0.3s ease;
    user-select:none;
  }
  .mode-btn.active {
    background:#ff9933; color:white; box-shadow:0 4px 12px rgb(255 153 51 / 0.6);
  }
  .mode-btn:hover:not(.active) {
    background:#f4a951; color:white;
  }
  #videoContainer {
    position:relative; max-width:100%; border-radius:12px; overflow:hidden; background:#000;
    aspect-ratio:16 / 9;
  }
  video, canvas {
    width:100%; height:auto; display:block;
  }
  canvas {
    position:absolute; top:0; left:0; pointer-events:none;
  }
  #uploadArea {
    border:3px dashed #ff9933; border-radius:12px; padding:2rem;
    text-align:center; color:#666; cursor:pointer; transition:background-color 0.3s ease;
    user-select:none; display:none;
  }
  #uploadArea:hover {
    background:#fff3e0; border-color:#ffb84d;
  }
  #uploadArea input[type="file"] {
    display:none;
  }
  #imageUpload {
    max-width:100%; max-height:400px; margin:1rem auto;
    border-radius:12px; box-shadow:0 4px 16px rgb(0 0 0 / 0.1); display:none;
  }
  #processingIndicator {
    display:none; justify-content:center; margin:1rem 0;
  }
  #processingIndicator div {
    width:24px; height:24px; margin:0 4px; background:#ff9933; border-radius:50%;
    animation:bounce 0.6s infinite alternate;
  }
  #processingIndicator div:nth-child(2) {
    animation-delay:0.2s;
  }
  #processingIndicator div:nth-child(3) {
    animation-delay:0.4s;
  }
  @keyframes bounce {
    from { transform: translateY(0); }
    to { transform: translateY(-12px); }
  }
  #detectionOverlay {
    margin-top:0.5rem; font-weight:600; text-align:center; color:#138808;
  }
  #detectionList {
    margin-top:1rem; max-height:200px; overflow-y:auto;
    border-top:1px solid #ddd; padding-top:1rem;
  }
  .detection-item {
    background: linear-gradient(135deg, rgba(255, 153, 51, 0.1), rgba(19, 136, 8, 0.05));
    border-radius:12px; padding:18px; margin-bottom:12px;
    border-left:4px solid #ff9933; transition:all 0.3s ease;
    border:1px solid rgba(255, 153, 51, 0.4); user-select:none;
  }
  .detection-item strong {
    color:#ff9933;
  }
  #statsBar {
    margin-top:1rem; display:flex; justify-content:space-around; gap:1rem;
    font-weight:600; color:#555;
  }
  .stat-card {
    flex:1; background:#f5f5f5; border-radius:12px; padding:0.7rem 1rem;
    text-align:center; user-select:none; box-shadow: inset 0 0 4px rgb(255 153 51 / 0.2);
  }
  .stat-value {
    font-size:1.3rem; color:#ff9933;
  }
  .stat-label {
    font-size:0.8rem; margin-top:2px; color:#138808;
  }
  #controlButtons {
    margin-top:1rem; text-align:center; user-select:none;
  }
  button {
    background:#ff9933; border:none; padding:0.7rem 1.5rem; border-radius:30px;
    font-weight:700; font-size:1rem; color:white; cursor:pointer; margin:0 0.5rem;
    transition:background-color 0.3s ease; user-select:none;
  }
  button:disabled {
    background:#ffcc99; cursor:not-allowed;
  }
  button:hover:not(:disabled) {
    background:#ffb84d;
  }
  /* Chatbot */
  .chatbot-container {
    position: fixed; bottom: 20px; right: 20px; z-index: 1000; font-family: 'Segoe UI', sans-serif;
  }
  .chatbot-toggle {
    background: #ff9933; border: none; border-radius: 50%; width: 56px; height: 56px;
    color: white; font-size: 28px; cursor: pointer;
    box-shadow: 0 4px 12px rgb(255 153 51 / 0.5); user-select:none;
  }
  .chatbot-window {
    display: none; flex-direction: column; width: 320px; height: 440px;
    background: white; border-radius: 16px; box-shadow: 0 8px 32px rgb(0 0 0 / 0.3);
    overflow: hidden;
  }
  .chatbot-header {
    background: #ff9933; color: white; padding: 1rem; font-weight: 700;
    font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center;
    user-select:none;
  }
  .chatbot-close {
    background: transparent; border: none; font-size: 1.6rem; color: white;
    cursor: pointer; font-weight: 700; user-select:none;
  }
  .chatbot-messages {
    flex: 1; overflow-y: auto; padding: 0.8rem; background: #fff7e6; font-size: 0.9rem;
  }
  .message {
    margin-bottom: 0.8rem; display: flex; flex-direction: column;
  }
  .message.user {
    align-items: flex-end;
  }
  .message.bot {
    align-items: flex-start;
  }
  .message-content {
    max-width: 80%; padding: 0.6rem 1rem; border-radius: 18px; line-height: 1.3;
    user-select: text;
  }
  .message.user .message-content {
    background: #ff9933; color: white; border-bottom-right-radius: 4px;
  }
  .message.bot .message-content {
    background: #138808; color: white; border-bottom-left-radius: 4px;
  }
  .chatbot-input {
    display: flex; padding: 0.6rem; border-top: 1px solid #ddd; background: #fff3e0;
  }
  #chatbotInput {
    flex: 1; padding: 0.5rem 1rem; font-size: 1rem; border: 1px solid #ff9933;
    border-radius: 30px; outline: none; user-select:text;
  }
  #chatbotSend {
    background: #138808; border: none; color: white; font-weight: 700;
    margin-left: 0.5rem; padding: 0 1.2rem; border-radius: 30px; cursor: pointer;
    user-select:none;
  }
  #chatbotSend:hover {
    background: #0f6b06;
  }
  /* Responsive */
  @media (max-width: 600px) {
    main {
      width: 100%; margin: 0; border-radius: 0; box-shadow: none; padding: 1rem 0.5rem;
    }
    .chatbot-window {
      width: 100vw; height: 50vh; bottom: 0 !important; right: 0 !important;
      border-radius: 0;
    }
  }
</style>
</head>
<body>
<header>Indian Vehicle License Plate Detection - AI System</header>
<main>
  <div class="mode-selector" role="tablist" aria-label="Mode selection">
    <button id="cameraMode" class="mode-btn active" role="tab" aria-selected="true">Live Camera</button>
    <button id="uploadMode" class="mode-btn" role="tab" aria-selected="false">Upload Image</button>
  </div>

  <h2 id="modeTitle" style="text-align:center; color:#ff9933; font-weight:700;">🎥 Live Camera Feed</h2>

  <div id="videoContainer">
    <video id="videoFeed" autoplay muted playsinline></video>
    <canvas id="canvasOverlay"></canvas>
  </div>

  <div id="uploadArea" role="button" tabindex="0" aria-label="Upload image area">
    <p>Click or drag & drop to upload an image</p>
    <input type="file" id="fileInput" accept="image/*" />
  </div>
  <img id="imageUpload" alt="Uploaded image preview" />

  <div id="processingIndicator" aria-live="polite" aria-busy="true">
    <div></div><div></div><div></div>
  </div>

  <div id="detectionOverlay" aria-live="polite" role="status">Model Loaded - Ready for Detection</div>

  <div id="detectionList" aria-live="polite" aria-relevant="additions"></div>

  <div id="statsBar" role="region" aria-label="Detection statistics">
    <div class="stat-card" title="Total detections">
      <div class="stat-value" id="totalDetections">0</div>
      <div class="stat-label">Detections</div>
    </div>
    <div class="stat-card" title="Average confidence">
      <div class="stat-value" id="avgConfidence">0%</div>
      <div class="stat-label">Avg Confidence</div>
    </div>
    <div class="stat-card" title="System uptime">
      <div class="stat-value" id="uptime">0s</div>
      <div class="stat-label">Uptime</div>
    </div>
  </div>

  <div id="controlButtons">
    <button id="startBtn" aria-label="Start detection">Start</button>
    <button id="stopBtn" aria-label="Stop detection" disabled>Stop</button>
  </div>
</main>

<div class="chatbot-container" aria-label="Chatbot assistant">
  <button class="chatbot-toggle" id="chatbotToggle" aria-label="Open AI assistant">💬</button>
  <div class="chatbot-window" id="chatbotWindow" role="dialog" aria-modal="true" aria-labelledby="chatbotTitle">
    <div class="chatbot-header">
      <span id="chatbotTitle" class="chatbot-title">AI Assistant</span>
      <button class="chatbot-close" id="chatbotClose" aria-label="Close chatbot">×</button>
    </div>
    <div class="chatbot-messages" id="chatbotMessages" tabindex="0"></div>
    <div class="chatbot-input">
      <input type="text" id="chatbotInput" placeholder="Ask me about license plates..." autocomplete="off" aria-label="Chat input" />
      <button class="chatbot-send" id="chatbotSend" aria-label="Send message">Send</button>
    </div>
  </div>
</div>

<script>
  // DOM elements
  const video = document.getElementById('videoFeed');
  const canvas = document.getElementById('canvasOverlay');
  const ctx = canvas.getContext('2d');
  const fileInput = document.getElementById('fileInput');
  const uploadArea = document.getElementById('uploadArea');
  const imageUpload = document.getElementById('imageUpload');
  const detectionOverlay = document.getElementById('detectionOverlay');
  const processingIndicator = document.getElementById('processingIndicator');
  const detectionList = document.getElementById('detectionList');
  const totalDetectionsEl = document.getElementById('totalDetections');
  const avgConfidenceEl = document.getElementById('avgConfidence');
  const uptimeEl = document.getElementById('uptime');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');

  const modeBtns = {
    camera: document.getElementById('cameraMode'),
    upload: document.getElementById('uploadMode'),
  };
  const modeTitle = document.getElementById('modeTitle');

  // Chatbot elements
  const chatbotToggle = document.getElementById('chatbotToggle');
  const chatbotWindow = document.getElementById('chatbotWindow');
  const chatbotClose = document.getElementById('chatbotClose');
  const chatbotMessages = document.getElementById('chatbotMessages');
  const chatbotInput = document.getElementById('chatbotInput');
  const chatbotSend = document.getElementById('chatbotSend');

  // State
  let currentMode = 'camera';
  let videoStream = null;
  let detectionRequestId = null;
  let isDetecting = false;
  let startTime = null;
  let totalDetections = 0;
  let totalConfidence = 0;

  // Helper: sleep
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  // Switch mode UI and reset
  function switchMode(mode) {
    if (currentMode === mode) return;
    currentMode = mode;
    for (let m in modeBtns) {
      modeBtns[m].classList.toggle('active', m === mode);
      modeBtns[m].setAttribute('aria-selected', m === mode ? 'true' : 'false');
    }
    stopDetection();
    detectionList.innerHTML = '';
    totalDetections = 0; totalConfidence = 0;
    updateStats();

    if (mode === 'camera') {
      modeTitle.textContent = '🎥 Live Camera Feed';
      video.style.display = 'block';
      canvas.style.display = 'block';
      uploadArea.style.display = 'none';
      imageUpload.style.display = 'none';
      startBtn.disabled = false;
      stopBtn.disabled = true;
      detectionOverlay.textContent = 'Model Loaded - Ready for Detection';
    } else if (mode === 'upload') {
      modeTitle.textContent = '📁 Upload Image';
      video.style.display = 'none';
      canvas.style.display = 'none';
      uploadArea.style.display = 'flex';
      imageUpload.style.display = 'none';
      startBtn.disabled = true;
      stopBtn.disabled = true;
      detectionOverlay.textContent = 'Upload an image to detect license plate.';
    }
  }

  // Update stats panel
  function updateStats() {
    totalDetectionsEl.textContent = totalDetections;
    const avg = totalDetections ? (totalConfidence / totalDetections * 100).toFixed(1) : '0';
    avgConfidenceEl.textContent = avg + '%';

    if (startTime) {
      const diff = Math.floor((Date.now() - startTime) / 1000);
      uptimeEl.textContent = diff + 's';
    } else {
      uptimeEl.textContent = '0s';
    }
  }

  // Dummy detection function (replace with your model call or API)
  function dummyDetect(imageData) {
    // Simulate detection of 1-2 plates randomly
    const results = [];
    const n = Math.floor(Math.random() * 2) + 1;
    for (let i=0; i<n; i++) {
      // Random bounding box on image
      const x = Math.random() * 0.7 + 0.15;
      const y = Math.random() * 0.7 + 0.15;
      const w = Math.random() * 0.3 + 0.15;
      const h = Math.random() * 0.15 + 0.1;
      const conf = Math.random() * 0.3 + 0.7;
      const plateNum = "MH" + Math.floor(1000 + Math.random() * 9000) + "AB";
      const valid = (Math.random() > 0.3);
      results.push({
        box: [x, y, w, h], conf, plateNum, valid
      });
    }
    return results;
  }

  // Draw detections on canvas
  function drawDetections(detections, width, height) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.lineWidth = 3;
    ctx.font = "16px Segoe UI";
    ctx.textBaseline = "top";

    detections.forEach(det => {
      const [x, y, w, h] = det.box;
      const left = x * width;
      const top = y * height;
      const boxW = w * width;
      const boxH = h * height;

      ctx.strokeStyle = det.valid ? "#138808" : "#cc0000";
      ctx.fillStyle = det.valid ? "rgba(19, 136, 8, 0.15)" : "rgba(204, 0, 0, 0.15)";
      ctx.fillRect(left, top, boxW, boxH);
      ctx.strokeRect(left, top, boxW, boxH);

      ctx.fillStyle = det.valid ? "#138808" : "#cc0000";
      const label = `${det.plateNum} (${(det.conf * 100).toFixed(1)}%) ${det.valid ? '✅ Valid' : '❌ Invalid'}`;
      ctx.fillText(label, left + 6, top + 4);
    });
  }

  // Process one video frame
  async function processVideoFrame() {
    if (!isDetecting) return;

    if (video.readyState >= 2) {
      // Resize canvas to video size
      if (canvas.width !== video.videoWidth || canvas.height !== video.videoHeight) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
      }

      // Grab frame from video
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);

      // Dummy detection - replace with actual ML model call
      const detections = dummyDetect(frame);

      // Update detection stats
      totalDetections += detections.length;
      totalConfidence += detections.reduce((sum, d) => sum + d.conf, 0);
      updateStats();

      // Draw boxes
      drawDetections(detections, canvas.width, canvas.height);

      // Update detection list text
      detectionList.innerHTML = '';
      detections.forEach((det, i) => {
        const item = document.createElement('div');
        item.className = 'detection-item';
        item.innerHTML = `<strong>Plate:</strong> ${det.plateNum} <br>
                          <strong>Confidence:</strong> ${(det.conf * 100).toFixed(1)}% <br>
                          <strong>Status:</strong> ${det.valid ? 'Valid ✅' : 'Invalid ❌'}`;
        detectionList.appendChild(item);
      });

      detectionOverlay.textContent = `Detected ${detections.length} plate(s) in current frame`;
    }

    detectionRequestId = requestAnimationFrame(processVideoFrame);
  }

  // Start detection on camera mode
  async function startDetection() {
    if (currentMode !== 'camera') return;
    if (isDetecting) return;
    startBtn.disabled = true;
    stopBtn.disabled = false;
    detectionOverlay.textContent = 'Starting camera...';

    try {
      videoStream = await navigator.mediaDevices.getUserMedia({video: {facingMode: "environment"}, audio:false});
      video.srcObject = videoStream;
      await video.play();
      startTime = Date.now();
      totalDetections = 0; totalConfidence = 0;
      isDetecting = true;
      updateStats();
      detectionOverlay.textContent = 'Detecting license plates...';
      detectionRequestId = requestAnimationFrame(processVideoFrame);
    } catch(err) {
      detectionOverlay.textContent = 'Error accessing camera: ' + err.message;
      startBtn.disabled = false;
      stopBtn.disabled = true;
    }
  }

  // Stop detection
  function stopDetection() {
    isDetecting = false;
    startBtn.disabled = false;
    stopBtn.disabled = true;
    detectionOverlay.textContent = 'Detection stopped.';
    if (detectionRequestId) cancelAnimationFrame(detectionRequestId);
    if (videoStream) {
      videoStream.getTracks().forEach(track => track.stop());
      video.srcObject = null;
      videoStream = null;
    }
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  // Handle file upload detection
  function detectUploadImage(file) {
    if (!file) return;
    detectionOverlay.textContent = 'Processing image...';
    processingIndicator.style.display = 'flex';

    const reader = new FileReader();
    reader.onload = function(event) {
      imageUpload.src = event.target.result;
      imageUpload.style.display = 'block';
      uploadArea.style.display = 'none';

      // After image loads, run detection
      imageUpload.onload = () => {
        // Resize canvas to image size for overlay
        canvas.width = imageUpload.naturalWidth;
        canvas.height = imageUpload.naturalHeight;
        canvas.style.position = 'relative';
        canvas.style.width = '100%';
        canvas.style.height = 'auto';
        canvas.style.display = 'block';

        // Dummy detection (replace with model)
        const detections = dummyDetect(null);

        // Draw detections on canvas
        drawDetections(detections, canvas.width, canvas.height);

        // Show detection info
        detectionList.innerHTML = '';
        detections.forEach((det) => {
          const item = document.createElement('div');
          item.className = 'detection-item';
          item.innerHTML = `<strong>Plate:</strong> ${det.plateNum} <br>
                            <strong>Confidence:</strong> ${(det.conf * 100).toFixed(1)}% <br>
                            <strong>Status:</strong> ${det.valid ? 'Valid ✅' : 'Invalid ❌'}`;
          detectionList.appendChild(item);
        });
        totalDetections = detections.length;
        totalConfidence = detections.reduce((sum, d) => sum + d.conf, 0);
        updateStats();

        detectionOverlay.textContent = `Detected ${detections.length} plate(s) in uploaded image`;
        processingIndicator.style.display = 'none';
      };
    };
    reader.readAsDataURL(file);
  }

  // Drag & drop upload
  uploadArea.addEventListener('dragover', e => {
    e.preventDefault();
    uploadArea.style.background = '#fff3e0';
  });
  uploadArea.addEventListener('dragleave', e => {
    e.preventDefault();
    uploadArea.style.background = '';
  });
  uploadArea.addEventListener('drop', e => {
    e.preventDefault();
    uploadArea.style.background = '';
    if (e.dataTransfer.files.length) {
      detectUploadImage(e.dataTransfer.files[0]);
    }
  });
  uploadArea.addEventListener('click', () => fileInput.click());
  uploadArea.addEventListener('keypress', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      fileInput.click();
    }
  });

  fileInput.addEventListener('change', e => {
    if (e.target.files.length) {
      detectUploadImage(e.target.files[0]);
    }
  });

  // Mode buttons
  modeBtns.camera.addEventListener('click', () => switchMode('camera'));
  modeBtns.upload.addEventListener('click', () => switchMode('upload'));

  // Control buttons
  startBtn.addEventListener('click', startDetection);
  stopBtn.addEventListener('click', stopDetection);

  // Initial mode setup
  switchMode('camera');

  // Chatbot logic (simple demo)
  function addMessage(text, sender='bot') {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message', sender);
    const content = document.createElement('div');
    content.className = 'message-content';
    content.textContent = text;
    msgDiv.appendChild(content);
    chatbotMessages.appendChild(msgDiv);
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
  }

  function processUserInput(input) {
    const lower = input.toLowerCase();
    if (lower.includes('valid') || lower.includes('invalid')) {
      addMessage("License plates in India follow the format: Two letters for state code, two digits for district, and four digits unique to the vehicle. If the plate matches this pattern, it is considered valid.");
    } else if (lower.includes('how') && lower.includes('detect')) {
      addMessage("We use AI and OCR techniques to detect license plates from images or live camera feed.");
    } else if (lower.includes('help')) {
      addMessage("You can upload an image or use your camera to detect license plates. Ask me anything about Indian plates!");
    } else {
      addMessage("Sorry, I didn't get that. Try asking about Indian license plates or detection methods.");
    }
  }

  chatbotToggle.addEventListener('click', () => {
    chatbotWindow.style.display = 'flex';
    chatbotToggle.style.display = 'none';
    chatbotInput.focus();
  });

  chatbotClose.addEventListener('click', () => {
    chatbotWindow.style.display = 'none';
    chatbotToggle.style.display = 'inline-block';
  });

  chatbotSend.addEventListener('click', () => {
    const text = chatbotInput.value.trim();
    if (!text) return;
    addMessage(text, 'user');
    chatbotInput.value = '';
    setTimeout(() => processUserInput(text), 500);
  });

  chatbotInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      chatbotSend.click();
    }
  });

</script>
</body>
</html>
